"use strict";!function(){let n,e,t,o,r={draw:0,win:0,lose:0},s,a,i;function c(){for(let n=0;n<e.length;n++)e[n].setAttribute("disabled","disabled")}function u(){for(let n=0;n<e.length;n++)e[n].removeAttribute("disabled")}function g(n){t.innerHTML=n}function d(n){o.innerHTML=["<h2>"+n+"</h2>","Won: "+r.win,"Lost: "+r.lose,"Draw: "+r.draw].join("<br>")}function f(){n.on("start",n=>{a=n,console.log(a),u(),g("Game Start!")});n.on("turn",n=>{console.log("turn",n),u(),g("Your turn!")});n.on("wait",n=>{console.log("wait",n),c(),g("Opponents turn!")});n.on("win",()=>{r.win++,d("You win!")});n.on("lose",()=>{r.lose++,d("You lose!")});n.on("draw",()=>{r.draw++,d("Draw!")});n.on("end",()=>{c(),g("Waiting for opponent...")});n.on("connect",()=>{c(),g("Waiting for opponent...")});n.on("disconnect",()=>{c(),g("Connection lost!")});n.on("error",()=>{c(),g("Connection error!")});for(let t=0;t<e.length;t++)((e,t)=>{e.addEventListener("click",function(e){c();n.emit("move",t)},!1)})(e[t],t+1)}function m(){n=io({upgrade:!1,transports:["websocket"]});e=document.getElementsByTagName("button");t=document.getElementById("message");o=document.getElementById("score");s=document.getElementById("game");i=l(640,480,s);a=void 0;c();f()}window.addEventListener("load",m,!1);function l(n,e,t){let o=new p(n,e,t),r=new v(n,e);o.setStage(r);o.setStageTransition(()=>{if(o.stage instanceof v){let t=new h(n,e);o.setStage(t)}});return o}class w{constructor(){if(w.instance){return w.instance}this.numOfImages=0;this.numComplete=0;this.images={};w.instance=this}loadImage(n,e){this.numOfImages++;let t=new Image;t.onload=()=>{w.instance.images[n]=t,w.instance.numComplete++};t.src=e}getImage(n){let e=this.images[n];if(e instanceof Image){return e}throw new Error(n+' is not a valid key')}getProgress(){return this.numComplete/this.numOfImages}loadingIsCompleted(){if(this.numOfImages===0){return!0}return this.getProgress()===1}}class p{constructor(n,e,t){this.w=n;this.h=e;this.canvas=t;this.canvas.width=this.w;this.canvas.height=this.h;this.ctx=this.canvas.getContext('2d');this.stage=void 0}setStage(n){this.stage=n;this.stage.ctx=this.ctx;this.stage.init()}setStageTransition(n){this.transitionFun=n}start(){this.running=!0;let n=this;function e(){let t=Date.now(),o=t-n.currentTime;n.currentTime=t;n.running&&n.update(o/1e3);n.render();window.requestAnimationFrame(e)}window.requestAnimationFrame(e)}stop(){this.running=!1}update(n){this.stage.finished&&this.transitionFun!==void 0&&this.transitionFun();this.stage!==void 0&&this.stage.update(n)}render(){this.ctx.save();this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.restore();this.stage!==void 0&&this.stage.render()}}class h{constructor(n,e){this.w=n;this.h=e;this.ctx=void 0;this.finished=!1;this.actors=[]}addActor(n){n.stage=this;n.init();this.actors.push(n)}init(){this.finished=!1}update(n){this.actors=this.actors.filter(n=>!n.remove);this.sortActorsByLayer();for(let e of this.actors)e.update(n)}render(){for(let n of this.actors)n.render()}sortActorsByLayer(){this.actors.sort((n,e)=>{return n.layer-e.layer})}}class v extends h{constructor(n,e){super(n,e);this.assetLoader=new w;this.progress=this.assetLoader.getProgress()}update(n){super.update(n);this.progress=this.assetLoader.getProgress();this.assetLoader.loadingIsCompleted()&&(this.finished=!0)}render(){super.render();this.ctx.save();this.drawProgress();this.ctx.restore()}drawProgress(){let n=20,e=this.w-n*2,t=50,o=e*this.progress;this.ctx.strokeRect(n,this.h/2-t/2,e,t);this.ctx.fillRect(n,this.h/2-t/2,o,t)}}}()