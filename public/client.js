"use strict";!function(){let n,t,e,o,r={draw:0,win:0,lose:0},s,a,i;function c(){for(let n=0;n<t.length;n++)t[n].setAttribute("disabled","disabled")}function u(){for(let n=0;n<t.length;n++)t[n].removeAttribute("disabled")}function g(n){e.innerHTML=n}function d(n){o.innerHTML=["<h2>"+n+"</h2>","Won: "+r.win,"Lost: "+r.lose,"Draw: "+r.draw].join("<br>")}function f(){n.on("start",n=>{a=n,console.log(a),u(),g("Game Start!")});n.on("turn",n=>{console.log("turn",n),u(),g("Your turn!")});n.on("wait",n=>{console.log("wait",n),c(),g("Opponents turn!")});n.on("win",()=>{r.win++,d("You win!")});n.on("lose",()=>{r.lose++,d("You lose!")});n.on("draw",()=>{r.draw++,d("Draw!")});n.on("end",()=>{c(),g("Waiting for opponent...")});n.on("connect",()=>{c(),g("Waiting for opponent...")});n.on("disconnect",()=>{c(),g("Connection lost!")});n.on("error",()=>{c(),g("Connection error!")});for(let e=0;e<t.length;e++)((t,e)=>{t.addEventListener("click",function(t){c();n.emit("move",e)},!1)})(t[e],e+1)}function l(){n=io({upgrade:!1,transports:["websocket"]});t=document.getElementsByTagName("button");e=document.getElementById("message");o=document.getElementById("score");s=document.getElementById("game");i=m(640,320,s);i.start();a=void 0;c();f()}window.addEventListener("load",l,!1);function m(n,t,e){let o=new h(n,t,e),r=new b(n,t);o.setStage(r);o.setStageTransition(()=>{if(o.stage instanceof b){let e=new y(n,t),r=new v(new w(30,30),30,{});e.addActor(r);o.setStage(e)}});return o}class w{constructor(n,t){this.x=n;this.y=t}}class p{constructor(){if(p.instance){return p.instance}this.numOfImages=0;this.numComplete=0;this.images={};p.instance=this}loadImage(n,t){this.numOfImages++;let e=new Image;e.onload=()=>{p.instance.images[n]=e,p.instance.numComplete++};e.src=t}getImage(n){let t=this.images[n];if(t instanceof Image){return t}throw new Error(n+' is not a valid key')}getProgress(){return this.numComplete/this.numOfImages}loadingIsCompleted(){if(this.numOfImages===0){return!0}return this.getProgress()===1}}class h{constructor(n,t,e){this.w=n;this.h=t;this.canvas=e;this.canvas.width=this.w;this.canvas.height=this.h;this.ctx=this.canvas.getContext('2d');this.stage=void 0}setStage(n){this.stage=n;this.stage.ctx=this.ctx;this.stage.init()}setStageTransition(n){this.transitionFun=n}start(){this.running=!0;let n=this;function t(){let e=Date.now(),o=e-n.currentTime;n.currentTime=e;n.running&&n.update(o/1e3);n.render();window.requestAnimationFrame(t)}window.requestAnimationFrame(t)}stop(){this.running=!1}update(n){this.stage.finished&&this.transitionFun!==void 0&&this.transitionFun();this.stage!==void 0&&this.stage.update(n)}render(){this.ctx.save();this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);this.ctx.restore();this.stage!==void 0&&this.stage.render()}}class y{constructor(n,t){this.w=n;this.h=t;this.ctx=void 0;this.finished=!1;this.actors=[]}addActor(n){n.stage=this;n.init();this.actors.push(n)}init(){this.finished=!1}update(n){this.actors=this.actors.filter(n=>!n.remove);this.sortActorsByLayer();for(let t of this.actors)t.update(n)}render(){for(let n of this.actors)n.render()}sortActorsByLayer(){this.actors.sort((n,t)=>{return n.layer-t.layer})}}class b extends y{constructor(n,t){super(n,t);this.assetLoader=new p;this.progress=this.assetLoader.getProgress()}update(n){super.update(n);this.progress=this.assetLoader.getProgress();this.assetLoader.loadingIsCompleted()&&(this.finished=!0)}render(){super.render();this.ctx.save();this.drawProgress();this.ctx.restore()}drawProgress(){let n=20,t=this.w-n*2,e=50,o=t*this.progress;this.ctx.strokeRect(n,this.h/2-e/2,t,e);this.ctx.fillRect(n,this.h/2-e/2,o,e)}}class x{constructor(n,t){this.pos=n;this.layer=t.layer?t.layer:0;this.stage=t.stage?t.stage:void 0;this.debugColour=t.debugColour?t.debugColour:'#000000';this.remove=!1}init(){}update(n){}render(){this.debugDraw()}debugDraw(){}}class v extends x{constructor(n,t,e){super(n,e);this.r=t}debugDraw(){let n=this.stage.ctx;n.beginPath();n.fillStyle=this.debugColour;n.arc(this.pos.x,this.pos.y,this.r,0,2*Math.PI);n.fill()}}}()